# Environment Configuration

## Frontend Environment Variables (.env)

```env
# Stripe Configuration
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_your_publishable_key_here

# Google Sheets Configuration
VITE_GOOGLE_SHEETS_SHEET_ID=your_sheet_id_here

# API Configuration
VITE_API_BASE=https://your-backend-domain.com
VITE_SUCCESS_URL=https://your-domain.com/payment-success?success=true
VITE_CANCEL_URL=https://your-domain.com/payment-cancelled

# Optional: Development
# VITE_API_BASE=http://localhost:3001
# VITE_SUCCESS_URL=http://localhost:5173/payment-success?success=true
# VITE_CANCEL_URL=http://localhost:5173/
```

## Backend Environment Variables (.env)

```env
# Node Environment
NODE_ENV=production

# Port
PORT=3001

# Stripe Configuration
STRIPE_SECRET_KEY=sk_live_your_secret_key_here
STRIPE_PUBLISHABLE_KEY=pk_live_your_publishable_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Google Sheets Configuration
GOOGLE_SHEETS_ID=your_sheet_id_here
GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@project.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account",...} # JSON key as string with escaped newlines

# Email Configuration
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-specific-password

# CORS
FRONTEND_URL=https://your-domain.com
```

## How to Get Required Credentials

### 1. Stripe API Keys

1. Sign up at [stripe.com](https://stripe.com)
2. Go to Dashboard → Developers → API keys
3. Copy the Publishable key (starts with `pk_`)
4. Copy the Secret key (starts with `sk_`)
5. For webhook: Developers → Webhooks → Add endpoint
   - URL: `https://your-backend.com/api/webhooks/stripe`
   - Events: `checkout.session.completed`, `checkout.session.expired`
   - Copy the Signing secret (starts with `whsec_`)

### 2. Google Sheets Configuration

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project
3. Enable Google Sheets API:
   - APIs & Services → Library
   - Search "Google Sheets API"
   - Click Enable
4. Create Service Account:
   - APIs & Services → Credentials
   - Create Credentials → Service Account
   - Fill in the details
   - Create & Continue
   - Grant "Editor" role
   - Create Key (JSON format)
5. Download the JSON key file and extract:
   - `GOOGLE_SERVICE_ACCOUNT_EMAIL` (from the JSON)
   - `GOOGLE_SERVICE_ACCOUNT_KEY` (entire JSON as string)

### 3. Create Google Sheet

1. Go to [Google Sheets](https://sheets.google.com)
2. Create a new blank spreadsheet
3. Name it something like "Ticket Purchases"
4. Add column headers in the first row:
   ```
   order_reference | customer_name | customer_email | customer_phone | 
   quantity | amount_total | stripe_session_id | stripe_payment_intent_id | 
   status | created_at | updated_at
   ```
5. Share the sheet with the service account email
6. Copy the Sheet ID from the URL (between `/d/` and `/edit`)

### 4. Gmail Configuration (for Email Confirmations)

1. Use a Gmail account
2. Enable 2-Factor Authentication
3. Create an App Password:
   - Go to [myaccount.google.com](https://myaccount.google.com)
   - Security → App passwords
   - Select Mail and Windows Computer
   - Generate password
   - Use this as `EMAIL_PASSWORD`

## Local Development Setup

### Step 1: Install Dependencies

Frontend:
```bash
cd frontend
npm install
```

Backend:
```bash
cd backend
npm install
```

### Step 2: Create Environment Files

Frontend `.env`:
```env
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
VITE_GOOGLE_SHEETS_SHEET_ID=xxxxx
VITE_API_BASE=http://localhost:3001
VITE_SUCCESS_URL=http://localhost:5173/payment-success?success=true
VITE_CANCEL_URL=http://localhost:5173/
```

Backend `.env`:
```env
NODE_ENV=development
PORT=3001
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_test_xxxxx
GOOGLE_SHEETS_ID=xxxxx
GOOGLE_SERVICE_ACCOUNT_EMAIL=xxxxx@iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account",...}
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
FRONTEND_URL=http://localhost:5173
```

### Step 3: Start Development Servers

Terminal 1 - Frontend:
```bash
cd frontend
npm run dev
```

Terminal 2 - Backend:
```bash
cd backend
node server.js
```

### Step 4: Test the Integration

1. Navigate to http://localhost:5173
2. Click "Book Your Seat"
3. Fill in test details
4. Use Stripe test card: `4242 4242 4242 4242` with any future date and CVC
5. Complete payment
6. Check if entry appears in Google Sheet
7. Check email for confirmation

## Production Deployment

1. Set up environment variables on your hosting platform (Vercel, Heroku, AWS, etc.)
2. Update `VITE_API_BASE` to your production backend URL
3. Use live Stripe API keys (pk_live_ and sk_live_)
4. Update `FRONTEND_URL` in backend to your production frontend
5. Set up SSL/HTTPS for webhook security
6. Test the webhook endpoint with Stripe's webhook testing tool

## Troubleshooting

### Payment not processing
- Check Stripe API keys are correct
- Verify webhook endpoint is configured
- Check backend logs for errors

### Google Sheets not updating
- Verify service account has access to the sheet
- Check sheet column names match exactly
- Ensure GOOGLE_SERVICE_ACCOUNT_KEY is properly escaped

### Emails not sending
- Verify Gmail credentials
- Check if App Password is being used (not regular password)
- Review email configuration in backend

### CORS errors
- Add frontend URL to CORS whitelist in backend
- Ensure API_BASE points to correct backend URL
